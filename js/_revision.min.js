"use strict";dotclear.ready((()=>{dotclear.dcRevisions=dotclear.getData("dcrevisions");const e=(e,t)=>{let s="",l="",o=0;for(const t of e){const n=t.nodeName,r=t.textContent;let i=t.getAttribute("oline")??"",c=t.getAttribute("nline")??"";"skip"===n&&(i=c="&hellip;");let d=["skip","context","insert","delete"].includes(n)?` ${n}`:"";n===l||""!==l&&"context"!==l||(d+=" first");const a=e.length>o+1?e[o+1].nodeName:"";n!==a&&"insert"!==a&&"delete"!==a&&(d+=" last"),l=n,s+=`<tr><td class="minimal col-line">${i}</td><td class="minimal col-line">${c}</td><td class="${d}">${r}</td></tr>`,o++}return""!==s?`<thead><tr class="rev-header"><th colspan="3">${t}</th></tr><tr class="rev-number"><th class="minimal nowrap">${dotclear.dcRevisions.msg.current}</th><th class="minimal nowrap">${dotclear.dcRevisions.msg.revision}</th><th class="maximal"></th></tr></thead><tbody>${s}</tbody>`:""},t=(t,s="toggle",l=null)=>{if(null===t.getAttribute("id"))return;const o=t.getAttribute("id").substring(1),n=document.getElementById("id").value;let r=document.getElementById(`re${o}`);r?(r.style.display="none"===r.style.display?"":"none",t.classList.toggle("expand")):dotclear.servicesGet("getPatch",(s=>{const l=(new DOMParser).parseFromString(s,"text/xml");if("ok"===l.querySelector("rsp")?.getAttribute("status")){r=document.createElement("tr"),r.id=`re${o}`;const s=document.createElement("td");s.colSpan=t.querySelectorAll("td").length,s.className="expand",r.appendChild(s);const n=document.getElementById("post_format").value;let i,c;if("xhtml"===n?(i=l.querySelector("post_excerpt_xhtml").childNodes,c=l.querySelector("post_content_xhtml").childNodes):(i=l.querySelector("post_excerpt").childNodes,c=l.querySelector("post_content").childNodes),0===i.length&&0===c.length)s.append(...dotclear.htmlToNodes(`<strong>${dotclear.dcRevisions.msg.content_identical}</strong>`));else{let t='<table class="preview-rev">';t+=e(i,dotclear.dcRevisions.msg.excerpt),t+=e(c,dotclear.dcRevisions.msg.content),t+="</table>",s.append(...dotclear.htmlToNodes(t))}return t.classList.add("expand"),void t.parentNode.insertBefore(r,t.nextSibling)}t.classList.toggle("expand"),window.alert(l.querySelector("message")?.textContent)}),{pid:n,rid:o,type:dotclear.dcRevisions.post_type})};dotclear.toggleWithDetails(document.getElementById("revisions-details"),{user_pref:"dcx_post_revisions",fn:void dotclear.expandContent({lines:document.querySelectorAll("#revisions-list tr.line"),callback:t})});for(const e of document.querySelectorAll("#revisions-list tr.line a.patch"))e.addEventListener("click",(e=>dotclear.confirm(dotclear.dcRevisions.msg.confirm_apply_patch,e)));document.getElementById("revpurge")?.addEventListener("click",(e=>dotclear.confirm(dotclear.dcRevisions.msg.confirm_purge_revision,e))),dotclear.responsiveCellHeaders(document.querySelector("#revisions-list"),"#revisions-list",1,!0)}));
